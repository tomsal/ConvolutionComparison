\documentclass[12pt,a4paper]{article}
\usepackage{graphicx}
\usepackage[showframe=false]{geometry}
\usepackage{changepage}
\usepackage{floatrow}
\usepackage[colorlinks=false]{hyperref} 
\usepackage[abs]{overpic}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{float}
\usepackage{enumitem,blindtext}
\usepackage{xcolor}
\usepackage{capt-of}

% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{9} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{9}  % for normal

% Custom colors
\usepackage{color}
\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.5,0}

\usepackage{listings}

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
language=Python,
basicstyle=\ttm,
otherkeywords={self},             % Add keywords here
keywordstyle=\ttb\color{deepblue},
emph={MyClass,__init__},          % Custom highlighting
emphstyle=\ttb\color{deepred},    % Custom highlighting style
stringstyle=\color{deepgreen},
frame=tb,                         % Any extra options here
showstringspaces=false            % 
}}

% Python environment
\lstnewenvironment{python}[1][]
{
\pythonstyle
\lstset{#1}
}
{}

% Python for external files
\newcommand\pythonexternal[2][]{{
\pythonstyle
\lstinputlisting[#1]{#2}}}

% Python for inline
\newcommand\pythoninline[1]{{\pythonstyle\lstinline!#1!}}

\lstdefinestyle{BashInputStyle}{
  language=bash,
  basicstyle=\small\sffamily,
  %frame=tb,
  columns=fullflexible,
  backgroundcolor=\color{gray!20},
  linewidth=\linewidth,
}


\begin{document}
\setlength{\parindent}{0pt}

\setlist{noitemsep}

\section{Problem}
- feature computation is bottleneck in classification process
- current vigra convolution is slow
- evaluate the improvement that comes with a GPU implementation

\section{Current situation and idea}
- Vigra single thread implementation
- use a ready to use library for GPU implementation as CUDA code requires high maintenance, high effort to be efficient and flexible
- use arrayfire

\section{Why arrayfire?}
- uses CUDA and OpenCL backend
  - makes use of many features of the respective libraries and GPUs
- flexible
- actively developed
- good support
Advantages over other implementations:
OpenGL
- does not make use of all available features of the GPUs (e.g. uses texture buffer, no shared memory)
OpenCV
- arrayfire claims to be faster
- OpenCV can be considered to replace VIGRA

\section{TODO}
  \begin{itemize}
    \item (29.01.) Compare CUDA vs. VIGRA vs. ArrayFire in C++
    \item (08.02.) Implement arrayfire hessianofgaussian or stensor (C++ or python)
    \item (02.02.) Checkout OpenCV CUDA/OpenCL performance
    \item (29.01.) Implement CUDA c++ gaussian (ignore padding)
    \item DONE: (08.02.) Compare python vigra, opencv, arrayfire
    \item DONE: (03.02.) Investigate data movement in ArrayFire (see af usergroup post)
    \item DONE: (29.01.) Implement ArrayFire c++ gaussian (ignore padding)
    \item DONE: (29.01.) Implement VIGRA c++ gaussian (ignore padding)
  \end{itemize}


\section{Current setup}
  \subsection{vigra.filters.gaussianSmoothing(img, sigma)}
    \begin{itemize}
      \item separated x-,y- convolution
      \item kernel is initialized from scratch for every call
      \item kernel element: $k[i] = \frac{1}{\sqrt{2\pi}\sigma} e^{-\frac{i^2}{2\sigma^2}} $
      \item kernel radius: $r = \textrm{round}(3*\sigma)$
    \end{itemize}
  \subsection{vigra.filters.laplacianOfGaussian(img, sigma)}
  \subsection{vigra.filters.gaussianGradientMagnitude(img, sigma)}
  \subsection{vigra.filters.gaussianSmoothing(img, sigma) - vigra.filters.gaussianSmoothing(img, 0.66*sigma)}
  \subsection{vigra.filters.structureTensorEigenvalues(img, sigma, sigma/2.0)}
  \subsection{vigra.filters.hessianOfGaussianEigenvalues(img, sigma)}


\section{HiWi HCI Notes}

\subsection{09.02.2016 (h)}
  \begin{itemize}
    \item bigheron ip: 192.168.128.14
  \end{itemize}
  

\subsection{08.02.2016 (4h)}
  \begin{itemize}
    \item ran python comparison, approx arrayfire speed up of 10, approx opencv speed up of 2
    \item Sizes range from 256x256 to 10000x10000
    \item single image convolution is important, yet batching copy operations might be possible
  \end{itemize}
  

\subsection{02.02.2016 (2h)}
  Worked on arrayfire c++ implementation. Set up vigra and such on personal notebook.

\subsection{02.02.2016 (1.5h)}

  \subsubsection{OpenCV}
    \begin{itemize}
      \item CUDA support
      \item \url{http://docs.opencv.org/3.0.0/d4/d25/classcv_1_1cuda_1_1Convolution.html}
      \item Comparison OpenCV vs. ArrayFire (LibJacket) \url{http://mcclanahoochie.com/blog/2011/09/opencv-vs-libjacket-gpu-sobel-filtering/}
    \end{itemize}


\subsection{29.01.2016 (9:30 - 12:00, 12:30 - 14:30, 4.5h)}

  \subsubsection{ArrayFire}
    \begin{itemize}
      \item handles 1D,2D,3D convolutions
      \item allows batch processing (1 Kernel, n images or n Kernels, 1 image and so on)
      \item Does it seperate Kernels?
      \item Example: \url{http://www.arrayfire.com/docs/getting_started_2convolve_8cpp-example.htm}
    \end{itemize}

  \subsubsection{Talked to Sven}
    \begin{itemize}
      \item ArrayFire
      \item nexts steps (see todo)
      \item received Michaela's code
    \end{itemize}

  \subsubsection{Commands}

    Show vigra compiler options
    \begin{lstlisting}[style=BashInputStyle]
# vigra-config --cpp-flags --libs 
    \end{lstlisting}

\subsection{26.01.2016 (3h)}

  Base on CUDA samples. separableConvolution and textureConvolution are already implemented.

  \subsubsection{snippets}
    \begin{python}[caption="print out gaussian 1D kernel"]
import vigra

sigma = 3

kernel = vigra.filters.Kernel1D()
kernel.initGaussian(sigma)

for i in range(kernel.left(),kernel.right()+1):
  print kernel[i]
    \end{python}

  \subsubsection{Addresses}
    \begin{itemize}
      \item bigheron - GPU system
      \item hciwiki.iwr.uni-heidelberg.de
    \end{itemize}


\subsection{22.01.2016 (3h)}

  \subsubsection{Ideas}
    \begin{itemize}
      \item Vigra efficiency improvements
      \item CUDA/OpenCL (CUDA samples!)
      \item OpenGL
      \item FFT approach
    \end{itemize}

  \subsubsection{Commands}

    \begin{lstlisting}[style=BashInputStyle]
# source miniconda2/bin/activate ilastik-devel
# source miniconda2/bin/activate root
# conda create -n ilastik-devel -c ilastik ilastik-everything-but-tracking
    \end{lstlisting}

\end{document}
